# WOORIDO UX 플로우 - P0 Core (Demo 필수)

> **Purpose:** Demo Day 필수 플로우 정의
> **Last Updated:** 2026-01-21
> **Status:** Draft
> **Phase:** P0 (MVP Core)

---

## 개요

| 항목 | 값 |
|------|-----|
| 총 플로우 수 | 7개 |
| 도메인 | 인증, 챌린지, SNS, 금융 |
| 우선순위 | Demo 필수 |

---

## 1. 인증 도메인 (Auth)

### 1.1 비회원 → 인증 가드 플로우

> **트리거:** 비로그인 상태에서 보호된 페이지 접근
> **연관 API:** `POST /auth/login`
> **연관 시나리오:** S1 (검색 진입 → 첫 챌린지 가입)

```mermaid
flowchart TD
    A[보호된 페이지 접근] --> B{로그인 상태?}
    B --> |Yes| C[페이지 렌더링]
    B --> |No| D["returnTo URL 저장"]
    D --> E["/login 리다이렉트"]
    E --> F[로그인 화면]
    
    F --> G{소셜 로그인?}
    G --> |Yes| H[OAuth 플로우]
    G --> |No| I[이메일/PW 입력]
    
    H --> J{인증 성공?}
    I --> J
    
    J --> |Yes| K[JWT 토큰 저장]
    K --> L{returnTo 존재?}
    L --> |Yes| M[returnTo URL로 이동]
    L --> |No| N[홈으로 이동]
    
    J --> |No| O[에러 Toast]
    O --> F
    
    M --> C
    N --> P[홈 화면]
```

**보호된 페이지 목록:**
| 라우터 그룹 | 경로 | 설명 |
|------------|------|------|
| `(main)` | `/` | 홈 (내 챌린지) |
| `(main)` | `/groups/:id/*` | 챌린지 상세 (멤버 뷰) |
| `(main)` | `/mypage/*` | 마이페이지 |
| `(main)` | `/charge`, `/withdraw` | 충전/출금 |

### 1.2 초대 링크 → 챌린지 가입 플로우

> **트리거:** 외부에서 초대 딥링크 클릭
> **연관 API:** `GET /challenges/{id}`, `POST /challenges/{id}/join`
> **연관 시나리오:** S2 (초대 링크로 가입)

```mermaid
flowchart TD
    A[초대 링크 클릭] --> B[딥링크 파싱]
    B --> C{로그인 상태?}
    
    C -->|No| D[로그인 화면]
    D --> E["returnTo: /challenges/ID"]
    E --> F{회원?}
    F -->|No| G[회원가입 플로우]
    G --> H[가입 완료]
    F -->|Yes| I[로그인 완료]
    H --> I
    I --> J
    
    C -->|Yes| J[챌린지 상세 조회]
    J --> K["OOO님이 초대했습니다" 배너]
    K --> L{이미 멤버?}
    L -->|Yes| M[피드 탭으로 이동]
    L -->|No| N[가입 버튼 표시]
    
    N --> O[가입 모달]
    O --> P[비용 안내]
    P --> Q{잔액 충분?}
    Q -->|No| R[충전 모달]
    R --> S[충전 완료]
    S --> O
    Q -->|Yes| T[가입 확정]
    T --> U[보증금 락 처리]
    U --> V[입회비 지불]
    V --> W[가입 완료 🎉]
    W --> M
```

**딥링크 형식:**
```
https://woorido.com/invite/{challengeId}?ref={inviterId}
```

---

## 2. 챌린지 도메인 (Challenge)

### 2.1 정상 탈퇴 플로우

> **트리거:** 멤버가 자발적으로 탈퇴 요청
> **연관 API:** `DELETE /challenges/{id}/leave`
> **연관 시나리오:** M3 (챌린지 탈퇴)

```mermaid
flowchart TD
    A[설정 > 탈퇴하기] --> B[탈퇴 확인 모달]
    B --> C{미납 서포트?}
    
    C -->|Yes| D["미납 서포트 결제 필요" 안내]
    D --> E[미납 금액 표시]
    E --> F{결제?}
    F -->|Yes| G[미납 결제]
    G --> B
    F -->|No| H[탈퇴 취소]
    
    C -->|No| I{진행 중 투표?}
    I -->|Yes| J["투표 완료 후 탈퇴 가능" 안내]
    J --> K[대기]
    
    I -->|No| L[보증금 락 해제 안내]
    L --> M["보증금 100,000원이 가용 크레딧으로 전환됩니다"]
    M --> N{최종 확인?}
    N -->|No| H
    N -->|Yes| O[탈퇴 API 호출]
    O --> P[보증금 → 가용 크레딧]
    P --> Q[탈퇴 완료 Toast]
    Q --> R[홈으로 이동]
```

**탈퇴 조건 체크리스트:**
| 조건 | 통과 시 | 미통과 시 |
|------|--------|----------|
| 미납 없음 | 다음 단계 | 미납 결제 유도 |
| 진행 중 투표 없음 | 다음 단계 | 대기 안내 |
| 리더가 아님 | 다음 단계 | 권한 위임 선행 필요 |

### 2.2 강퇴(KICK) 플로우

> **트리거:** 리더 또는 멤버가 규칙 위반자 강퇴 요청
> **연관 API:** `POST /challenges/{id}/votes` (type: KICK)
> **연관 시나리오:** L4 (멤버 강퇴 투표)

```mermaid
flowchart TD
    A[멤버 관리 > 강퇴 요청] --> B[대상 멤버 선택]
    B --> C[강퇴 사유 입력]
    C --> D["⚠️ 70% 승인 필요" 경고]
    D --> E{계속?}
    E -->|No| F[취소]
    
    E -->|Yes| G[KICK 투표 생성]
    G --> H[전체 멤버 알림]
    H --> I[투표 진행 - 72시간]
    
    I --> J{70% 도달?}
    J -->|No - 시간 만료| K[투표 실패]
    K --> L["강퇴 투표가 부결되었습니다" Toast]
    
    J -->|Yes| M[강퇴 승인]
    M --> N[강제 탈퇴 처리]
    N --> O{미납 있음?}
    
    O -->|Yes| P[보증금으로 미납 충당]
    P --> Q[잔여 보증금 계산]
    Q --> R{잔여 있음?}
    R -->|Yes| S[잔여 → 가용 크레딧]
    R -->|No| T[보증금 전액 사용됨]
    
    O -->|No| S
    S --> U[피강퇴자 알림]
    T --> U
    U --> V["OOO님이 강퇴되었습니다" 공지]
```

**KICK 투표 규칙:**
| 항목 | 값 |
|------|-----|
| 발의 가능자 | 리더 또는 멤버 |
| 투표 대상 | 전체 멤버 (본인 제외) |
| 승인 조건 | 70% 이상 |
| 기한 | 72시간 |

---

## 3. SNS 도메인 (Social)

### 3.1 게시글 작성 플로우

> **트리거:** 피드 탭에서 글쓰기 버튼 클릭
> **연관 API:** `POST /challenges/{id}/posts`
> **연관 시나리오:** S4 (첫 피드 게시글 작성)

```mermaid
flowchart TD
    A[피드 탭] --> B[FAB + 클릭]
    B --> C[글쓰기 모달]
    
    C --> D[텍스트 입력]
    D --> E{이미지 첨부?}
    E -->|Yes| F[갤러리/카메라 선택]
    F --> G[이미지 업로드]
    G --> H[S3 URL 반환]
    H --> I[미리보기 표시]
    E -->|No| I
    
    I --> J{공지 설정?}
    J -->|Yes - 리더만| K[isPinned: true]
    J -->|No| L[isPinned: false]
    
    K --> M[게시 버튼]
    L --> M
    
    M --> N{유효성 검증}
    N -->|실패| O[에러 표시]
    O --> D
    
    N -->|성공| P[게시글 API 호출]
    P --> Q[성공 Toast]
    Q --> R[피드 맨 위 노출]
    R --> S[좋아요/댓글 대기]
```

**게시글 유효성 규칙:**
| 필드 | 규칙 |
|------|------|
| 내용 | 1~2000자 |
| 이미지 | 최대 5장, 각 10MB 이하 |
| 공지 | 리더만 설정 가능 |

### 3.2 댓글/좋아요 플로우

> **트리거:** 게시글에서 상호작용
> **연관 API:** `POST /comments`, `POST /like`

```mermaid
flowchart TD
    subgraph 좋아요
        A1[게시글 카드] --> B1[❤️ 버튼 탭]
        B1 --> C1{이미 좋아요?}
        C1 -->|No| D1[좋아요 API]
        D1 --> E1[하트 애니메이션]
        E1 --> F1[카운트 +1]
        C1 -->|Yes| G1[좋아요 취소 API]
        G1 --> H1[카운트 -1]
    end
    
    subgraph 댓글
        A2[게시글 카드] --> B2[💬 버튼 탭]
        B2 --> C2[댓글 섹션 펼침]
        C2 --> D2[댓글 입력란]
        D2 --> E2[텍스트 입력]
        E2 --> F2[전송 버튼]
        F2 --> G2[댓글 API 호출]
        G2 --> H2[댓글 목록 갱신]
        H2 --> I2[작성자에게 알림]
    end
    
    subgraph 대댓글
        J2[댓글] --> K2[답글 버튼]
        K2 --> L2["@닉네임" 자동 입력]
        L2 --> M2[대댓글 작성]
        M2 --> N2[parentId 설정]
        N2 --> O2[대댓글 API 호출]
    end
```

---

## 4. 금융 도메인 (Finance)

### 4.1 결제 실패/재시도 플로우

> **트리거:** 충전 또는 결제 시 PG 오류 발생
> **연관 API:** `POST /accounts/charge`, `POST /accounts/charge/callback`
> **연관 시나리오:** M1 (잔액 부족 → 충전)

```mermaid
flowchart TD
    A[충전 모달] --> B[금액 선택]
    B --> C[결제 수단 선택]
    C --> D[토스페이 연동]
    D --> E[PG 결제 요청]
    
    E --> F{PG 응답}
    
    F -->|성공| G[콜백 API 호출]
    G --> H[크레딧 증가]
    H --> I[성공 Toast]
    I --> J[잔액 UI 갱신]
    
    F -->|실패 - 카드 오류| K[카드 거절 안내]
    K --> L["다른 카드로 시도해주세요"]
    L --> C
    
    F -->|실패 - 네트워크| M[네트워크 오류 안내]
    M --> N["잠시 후 다시 시도해주세요"]
    N --> O[재시도 버튼]
    O --> E
    
    F -->|실패 - 한도 초과| P[한도 초과 안내]
    P --> Q["일일 한도: 1,000,000원"]
    Q --> R[다음날 안내]
    
    F -->|타임아웃| S[타임아웃 안내]
    S --> T[결제 상태 확인 API]
    T --> U{실제 결제됨?}
    U -->|Yes| G
    U -->|No| O
```

**에러 코드별 처리:**
| 에러 코드 | 원인 | UX 처리 |
|----------|------|---------|
| `CARD_DECLINED` | 카드 거절 | 다른 카드 유도 |
| `NETWORK_ERROR` | 네트워크 | 재시도 버튼 |
| `LIMIT_EXCEEDED` | 한도 초과 | 한도 안내 |
| `TIMEOUT` | 타임아웃 | 상태 확인 후 분기 |

---

## 관련 문서

- [UX_FLOW.md](./UX_FLOW.md) - 핵심 플로우 요약
- [UX_FLOW_P1.md](./UX_FLOW_P1.md) - P1 확장 플로우
- [UX_SCENARIOS.md](../Strategy/UX_SCENARIOS.md) - 시나리오 상세
- [P0_Core_APIs.md](../../../03_DEVOPS/P0_Core_APIs.md) - P0 API 목록
