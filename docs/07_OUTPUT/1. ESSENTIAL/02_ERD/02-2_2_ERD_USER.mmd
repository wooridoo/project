erDiagram
    %% ========================================
    %% 사용자 도메인 (User Domain)
    %% 테이블: 4개
    %% ========================================

    users {
        bigint id PK
        varchar email UK
        varchar password_hash
        varchar name
        varchar nickname
        varchar phone UK
        varchar profile_image_url
        varchar status "ACTIVE | INACTIVE | SUSPENDED | WITHDRAWN"
        timestamp created_at
        timestamp updated_at
        timestamp deleted_at
    }

    accounts {
        bigint id PK
        bigint user_id FK
        bigint challenge_id FK
        decimal balance
        varchar account_type "PERSONAL | CHALLENGE"
        timestamp created_at
        timestamp updated_at
    }

    account_transactions {
        bigint id PK
        bigint account_id FK
        bigint related_account_id FK
        varchar transaction_type "DEPOSIT | WITHDRAWAL | TRANSFER | FEE | PENALTY | REFUND"
        decimal amount
        decimal balance_after
        varchar description
        bigint reference_id
        varchar reference_type
        timestamp created_at
    }

    user_scores {
        bigint id PK
        bigint user_id FK
        int sweetness_score "0-100"
        int attendance_count
        int absence_count
        int late_payment_count
        timestamp calculated_at
        timestamp created_at
        timestamp updated_at
    }

    %% 관계
    users ||--o{ accounts : "has"
    users ||--o{ user_scores : "has"
    accounts ||--o{ account_transactions : "source"
    accounts ||--o{ account_transactions : "destination"